{% extends 'base.html' %}
{% load static %}

{% block page_title %}Planning de {{ employe.nom }} {{ employe.prenom }}{% endblock %}

{% block content %}
<div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="card-header text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fas fa-calendar-alt me-2"></i>
            Planning de {{ employe.nom }} {{ employe.prenom }}
        </h5>
        <div>
            <a href="{% url 'ajouter_semaine_planning' employe.pk %}" class="btn btn-light btn-sm me-2">
                <i class="fas fa-calendar-plus me-2"></i>Ajouter Semaine
            </a>
            <a href="{% url 'ajouter_planning' employe.pk %}" class="btn btn-light btn-sm">
                <i class="fas fa-plus-circle me-2"></i>Ajouter Horaire
            </a>
        </div>
    </div>
    
    <div class="card-body">
        <!-- Filtres -->
        <div class="row mb-4">
            <div class="col-md-4">
                <label class="form-label">Semaine</label>
                <select class="form-select" id="semaineFilter">
                    <option value="">Toutes les semaines</option>
                    {% for semaine in "12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152"|make_list %}
                        <option value="{{ forloop.counter }}" {% if forloop.counter == semaine_actuelle %}selected{% endif %}>
                            Semaine {{ forloop.counter }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Mois</label>
                <select class="form-select" id="moisFilter">
                    <option value="">Tous les mois</option>
                    <option value="1">Janvier</option>
                    <option value="2">Février</option>
                    <option value="3">Mars</option>
                    <option value="4">Avril</option>
                    <option value="5">Mai</option>
                    <option value="6">Juin</option>
                    <option value="7">Juillet</option>
                    <option value="8">Août</option>
                    <option value="9">Septembre</option>
                    <option value="10">Octobre</option>
                    <option value="11">Novembre</option>
                    <option value="12">Décembre</option>
                </select>
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button class="btn btn-primary w-100" onclick="filtrerPlanning()">
                    <i class="fas fa-filter me-2"></i>Filtrer
                </button>
            </div>
        </div>
        
        {% if plannings_par_semaine %}
            {% for semaine_cle, semaine_data in plannings_par_semaine.items %}
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-calendar-week me-2"></i>
                        {{ semaine_cle }} ({{ semaine_data.date_debut|date:"d/m/Y" }} - {{ semaine_data.date_fin|date:"d/m/Y" }})
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 15%;">Jour</th>
                                    <th style="width: 15%;">Heure début</th>
                                    <th style="width: 15%;">Heure fin</th>
                                    <th style="width: 10%;">Durée</th>
                                    <th style="width: 35%;">Notes</th>
                                    <th style="width: 10%;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for planning in semaine_data.plannings %}
                                <tr>
                                    <td>
                                        <span class="badge 
                                            {% if planning.jour == 'LUNDI' %}bg-primary
                                            {% elif planning.jour == 'MARDI' %}bg-success
                                            {% elif planning.jour == 'MERCREDI' %}bg-info
                                            {% elif planning.jour == 'JEUDI' %}bg-warning
                                            {% elif planning.jour == 'VENDREDI' %}bg-secondary
                                            {% elif planning.jour == 'SAMEDI' %}bg-danger
                                            {% else %}bg-dark{% endif %}">
                                            {{ planning.get_jour_display }}
                                        </span>
                                    </td>
                                    <td>{{ planning.heure_debut|time:"H:i" }}</td>
                                    <td>{{ planning.heure_fin|time:"H:i" }}</td>
                                    <td>{{ planning.duree }} h</td>
                                    <td>{{ planning.notes|default:"-" }}</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{% url 'modifier_planning' planning.pk %}" class="btn btn-warning" title="Modifier">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{% url 'supprimer_planning' planning.pk %}" class="btn btn-danger" title="Supprimer">
                                                <i class="fas fa-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-calendar-alt fa-4x text-muted mb-3"></i>
                <h5 class="text-muted">Aucun planning pour cet employé</h5>
                <p class="text-muted">Commencez par ajouter un planning</p>
                <div class="mt-3">
                    <a href="{% url 'ajouter_semaine_planning' employe.pk %}" class="btn btn-primary">
                        <i class="fas fa-calendar-plus me-2"></i>Créer une semaine
                    </a>
                    <a href="{% url 'ajouter_planning' employe.pk %}" class="btn btn-success">
                        <i class="fas fa-plus-circle me-2"></i>Ajouter manuellement
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>
function filtrerPlanning() {
    const semaine = document.getElementById('semaineFilter').value;
    const mois = document.getElementById('moisFilter').value;
    
    let url = "{% url 'planning_employe' employe.pk %}?";
    if (semaine) url += `semaine=${semaine}&`;
    if (mois) url += `mois=${mois}`;
    
    window.location.href = url;
}
</script>
{% endblock %}