<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Gestion STAGE PROD{% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome 6 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-brand">
        <i class="fas fa-building"></i>
        <span>STAGE PROD</span>
      </div>

      <div class="sidebar-menu">
        <div
          class="menu-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
        >
          <a href="{% url 'dashboard' %}">
            <i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </a>
        </div>

        <div class="menu-divider">Ressources Humaines</div>

        <div class="menu-item">
          <a href="{% url 'liste_employes' %}">
            <i class="fas fa-users"></i>
            <span>Employés</span>
          </a>
        </div>

        <div class="menu-item">
          <a href="{% url 'liste_freelancers' %}">
            <i class="fas fa-user-tie"></i>
            <span>Freelancers</span>
          </a>
        </div>

        <div class="menu-divider">Projets</div>

        <div class="menu-item">
          <a href="{% url 'liste_chantiers' %}">
            <i class="fas fa-hard-hat"></i>
            <span>Chantiers</span>
          </a>
        </div>

        <div class="menu-divider">Finance</div>

        <div class="menu-item">
          <a href="{% url 'finance_dashboard' %}">
            <i class="fas fa-euro-sign"></i>
            <span>Caisse</span>
          </a>
        </div>

        <div class="menu-item">
          <a href="{% url 'liste_primes' %}">
            <i class="fas fa-gift"></i>
            <span>Primes</span>
          </a>
        </div>

        <div class="menu-item">
          <a href="{% url 'liste_transactions' %}">
            <i class="fas fa-exchange-alt"></i>
            <span>Transactions</span>
          </a>
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="user-info">
          <i class="fas fa-user-circle"></i>
          <div>
            <strong>{{ user.username }}</strong>
            <small>Administrateur</small>
          </div>
        </div>

        <form method="post" action="{% url 'logout' %}" style="display: inline">
          {% csrf_token %}
          <button
            type="submit"
            class="logout-btn"
            style="
              width: 100%;
              border: none;
              background: none;
              padding: 10px 15px;
              color: white;
              text-align: left;
              cursor: pointer;
            "
          >
            <i class="fas fa-sign-out-alt"></i>
            Déconnexion
          </button>
        </form>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Header -->
      <div class="top-header">
        <div class="header-title">
          {% block page_title %}Dashboard{% endblock %}
        </div>

        <div class="header-actions">
          <!-- MODIFICATION ICI : Menu notifications avec dropdown -->
          <div class="dropdown">
            <button
              class="btn btn-light position-relative"
              type="button"
              id="notificationDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fas fa-bell"></i>
              <span class="notification-badge" id="notificationCount">0</span>
            </button>
            <div
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="notificationDropdown"
              style="width: 350px; padding: 0"
            >
              <div
                class="dropdown-header d-flex justify-content-between align-items-center bg-light"
              >
                <span><strong>Notifications</strong></span>
                <a href="#" id="markAllRead" class="text-primary small"
                  >Tout marquer comme lu</a
                >
              </div>
              <div
                id="notificationList"
                style="max-height: 400px; overflow-y: auto"
              >
                <!-- Les notifications seront chargées ici -->
                <div class="text-center p-3 text-muted">
                  <i class="fas fa-spinner fa-spin me-2"></i>Chargement...
                </div>
              </div>
              <div class="dropdown-footer text-center p-2 border-top">
                <a
                  href="{% url 'liste_notifications' %}"
                  class="text-primary small"
                  >Voir toutes les notifications</a
                >
              </div>
            </div>
          </div>
          <!-- NOUVEAU : Menu Paramètres/Utilitaires -->
          <div class="dropdown">
            <button
              class="btn btn-light"
              type="button"
              id="settingsDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fas fa-cog"></i>
            </button>
            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="settingsDropdown"
              style="min-width: 250px"
            >
              <!-- Profil utilisateur -->
              <li class="dropdown-header bg-light">
                <div class="d-flex align-items-center p-2">
                  <i class="fas fa-user-circle fa-2x me-2 text-primary"></i>
                  <div>
                    <strong
                      >{{ user.get_full_name|default:user.username }}</strong
                    ><br />
                    <small class="text-muted">{{ user.email }}</small>
                  </div>
                </div>
              </li>
              <li><hr class="dropdown-divider" /></li>

              <!-- Actions rapides -->
              <li><h6 class="dropdown-header">Actions rapides</h6></li>
              <li>
                <a class="dropdown-item" href="{% url 'ajouter_employe' %}">
                  <i class="fas fa-user-plus me-2 text-success"></i>Nouvel
                  employé
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="{% url 'ajouter_chantier' %}">
                  <i class="fas fa-hard-hat me-2 text-warning"></i>Nouveau
                  chantier
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="{% url 'ajouter_transaction' %}">
                  <i class="fas fa-euro-sign me-2 text-info"></i>Nouvelle
                  transaction
                </a>
              </li>

              <li><hr class="dropdown-divider" /></li>

              <!-- Outils -->
              <li><h6 class="dropdown-header">Outils</h6></li>
              <li>
                <a class="dropdown-item" href="#" onclick="window.print()">
                  <i class="fas fa-print me-2 text-secondary"></i>Imprimer cette
                  page
                </a>
              </li>
              <li>
                <a class="dropdown-item" href="#" id="refreshData">
                  <i class="fas fa-sync-alt me-2 text-primary"></i>Rafraîchir
                  les données
                </a>
              </li>

              <li><hr class="dropdown-divider" /></li>

              <!-- Administration -->
              <li><h6 class="dropdown-header">Administration</h6></li>
              <li>
                <a class="dropdown-item" href="{% url 'admin:index' %}">
                  <i class="fas fa-crown me-2 text-warning"></i>Admin Django
                </a>
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="#"
                  data-bs-toggle="modal"
                  data-bs-target="#aideModal"
                >
                  <i class="fas fa-question-circle me-2 text-info"></i>Aide
                </a>
              </li>

              <li><hr class="dropdown-divider" /></li>

              <!-- Thème (optionnel) -->
              <li>
                <div
                  class="dropdown-item d-flex justify-content-between align-items-center"
                >
                  <span
                    ><i class="fas fa-moon me-2 text-primary"></i>Mode
                    sombre</span
                  >
                  <div class="form-check form-switch">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="darkModeSwitch"
                    />
                  </div>
                </div>
              </li>

              <li><hr class="dropdown-divider" /></li>

              <!-- Déconnexion rapide -->
              <li>
                <form
                  method="post"
                  action="{% url 'logout' %}"
                  class="dropdown-item p-0"
                >
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item text-danger">
                    <i class="fas fa-sign-out-alt me-2"></i>Déconnexion
                  </button>
                </form>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Messages -->
      {% if messages %} {% for message in messages %}
      <div
        class="alert alert-{{ message.tags }} alert-dismissible fade show m-3"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %} {% endif %}

      <!-- Content -->
      <div class="content">{% block content %}{% endblock %}</div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{% static 'js/main.js' %}"></script>
    <!-- Script des notifications -->
    <script src="{% static 'js/notifications.js' %}"></script>
    {% block extra_js %}{% endblock %}
    <!-- Modal d'aide -->
    <div
      class="modal fade"
      id="aideModal"
      tabindex="-1"
      aria-labelledby="aideModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="aideModalLabel">
              <i class="fas fa-question-circle me-2"></i>Aide - Gestion STAGE
              PROD
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <h6>Bienvenue dans l'application de gestion</h6>
            <p>Voici les principales fonctionnalités :</p>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fas fa-users text-primary me-2"></i
                ><strong>Employés</strong> : Gérer les employés, avances sur
                salaire
              </li>
              <li class="mb-2">
                <i class="fas fa-user-tie text-success me-2"></i
                ><strong>Freelancers</strong> : Gérer les travailleurs
                temporaires
              </li>
              <li class="mb-2">
                <i class="fas fa-hard-hat text-warning me-2"></i
                ><strong>Chantiers</strong> : Gérer les projets et affectations
              </li>
              <li class="mb-2">
                <i class="fas fa-euro-sign text-info me-2"></i
                ><strong>Finance</strong> : Gérer la caisse et les transactions
              </li>
              <li class="mb-2">
                <i class="fas fa-calendar-alt text-danger me-2"></i
                ><strong>Planning</strong> : Planifier les horaires des employés
              </li>
            </ul>
            <hr />
            <p class="small text-muted mb-0">Version 1.0 - © 2026 STAGE PROD</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fermer
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
